<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1950s Indian Puppet Show Stage - Time Capsule</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: #f5deb3; /* Wheat color - more authentic to 1950s India */
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        #scene-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(245, 222, 179, 0.1), rgba(245, 222, 179, 0.3)); /* Matching the 1950s Indian afternoon aesthetic */
            pointer-events: none;
            z-index: 10;
        }

        /* Info panel styles removed as requested */

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(139, 69, 19, 0.8); /* Brown tone more suited to 1950s India */
            border: 1px solid rgba(210, 180, 140, 0.6);
            color: #f5f5dc;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            z-index: 20;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(160, 82, 45, 0.8);
            color: #ffffff;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5deb3; /* Match the 1950s India scene background */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease;
        }

        .loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(177, 156, 217, 0.3);
            border-radius: 50%;
            border-top-color: #b19cd9;
            animation: spin 1s infinite linear;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .camera-controls {
            position: absolute;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 20;
        }

        .camera-btn {
            background: rgba(139, 69, 19, 0.8); /* Brown tone more suited to 1950s India */
            border: 1px solid rgba(210, 180, 140, 0.6);
            color: #f5f5dc;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .camera-btn:hover {
            background: rgba(160, 82, 45, 0.8);
            color: #ffffff;
        }

        .view-btn {
            background: rgba(139, 69, 19, 0.8); /* Brown tone more suited to 1950s India */
            border: 1px solid rgba(210, 180, 140, 0.6);
            color: #f5f5dc;
            padding: 8px 15px;
            border-radius: 50px;
            font-size: 0.8rem;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .view-btn:hover {
            background: rgba(160, 82, 45, 0.8);
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div class="loading-screen">
        <div class="loader"></div>
        <p>Creating 1950s Indian Puppet Show Scene... (Rural India Setting)</p>
    </div>

    <div id="scene-container"></div>
    <div class="overlay"></div>
    
    <button class="back-button" onclick="window.location.href='index.html'">‚Üê Back to 1950s</button>

    <!-- Info panel removed as requested -->

    <div class="camera-controls">
        <div class="camera-btn" id="zoom-in">+</div>
        <div class="camera-btn" id="zoom-out">-</div>
        <div class="view-btn" id="toggle-view">Toggle View</div>
    </div>

    <script>
        // Scene setup variables
        let scene, camera, renderer, controls;
        let stage, curtains, backdrop, audience, tree, props;
        let currentView = 'front';
        let animationMixer;
        let clock = new THREE.Clock();
        
        // Initialize the scene
        function init() {
            console.log("Initializing scene...");
            try {
                // Create scene
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf5deb3); // Warm wheat color typical of 1950s India daytime
                scene.fog = new THREE.FogExp2(0xf5deb3, 0.001); // Light fog for authenticity
            
            // Create camera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 10);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('scene-container').appendChild(renderer.domElement);
            
            // Add orbit controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 3;
            controls.maxDistance = 20;
            controls.maxPolarAngle = Math.PI / 2;
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6); // Brighter ambient light for afternoon
            scene.add(ambientLight);
            
            // Add directional light (afternoon sun)
            const sunLight = new THREE.DirectionalLight(0xffffff, 1.0); // Bright white sunlight
            sunLight.position.set(5, 20, 5); // More overhead position for afternoon sun
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            sunLight.shadow.camera.near = 0.5;
            sunLight.shadow.camera.far = 50;
            sunLight.shadow.camera.left = -20;
            sunLight.shadow.camera.right = 20;
            sunLight.shadow.camera.top = 20;
            sunLight.shadow.camera.bottom = -20;
            scene.add(sunLight);
            
            // Add spotlight for stage
            const spotlight = new THREE.SpotLight(0xffffff, 0.8); // Whiter light for daytime
            spotlight.position.set(0, 5, 2);
            spotlight.angle = Math.PI / 6;
            spotlight.penumbra = 0.3;
            spotlight.decay = 1;
            spotlight.distance = 20;
            spotlight.castShadow = true;
            spotlight.shadow.mapSize.width = 1024;
            spotlight.shadow.mapSize.height = 1024;
            scene.add(spotlight);
            spotlight.target.position.set(0, 0, 0);
            scene.add(spotlight.target);
            
            // Create ground
            createGround();
            
            // Create puppet show stage
            createStage();
            
            // Create audience area
            createAudience();
            
            // Create surrounding environment
            createEnvironment();
            
            // Add event listeners
            window.addEventListener('resize', onWindowResize);
            
            // Camera controls
            document.getElementById('zoom-in').addEventListener('click', () => {
                gsap.to(camera.position, { z: camera.position.z - 1, duration: 0.5 });
            });
            
            document.getElementById('zoom-out').addEventListener('click', () => {
                gsap.to(camera.position, { z: camera.position.z + 1, duration: 0.5 });
            });
            
            document.getElementById('toggle-view').addEventListener('click', toggleView);
            
            // Info panel display code removed as requested
            
            // Hide loading screen after everything is set up
            setTimeout(() => {
                document.querySelector('.loading-screen').classList.add('fade-out');
            }, 2000);
            
            // Start animation loop
            animate();
            
            console.log("Scene initialization complete!");
            } catch (error) {
                console.error("Error initializing scene:", error);
                document.querySelector('.loading-screen').innerHTML = `
                    <div>Error initializing 3D scene:</div>
                    <div style="color: red; margin-top: 10px;">${error.message}</div>
                    <div style="margin-top: 20px;">Please try refreshing the page or check console for details.</div>
                `;
            }
        }
        
        function createGround() {
            console.log("Creating ground...");
            try {
                // Create dusty ground - more appropriate for 1950s rural India
                const groundGeometry = new THREE.PlaneGeometry(50, 50);
                const groundTexture = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/terrain/grasslight-big.jpg');
                groundTexture.wrapS = THREE.RepeatWrapping;
                groundTexture.wrapT = THREE.RepeatWrapping;
                groundTexture.repeat.set(10, 10);
            
            const groundMaterial = new THREE.MeshStandardMaterial({
                map: groundTexture,
                color: 0xd2b48c, // More earthy tone for rural Indian setting
                roughness: 0.9,
                metalness: 0.1
            });
            
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Add some scattered stones and leaves
            for (let i = 0; i < 50; i++) {
                const stoneSize = Math.random() * 0.2 + 0.05;
                const stoneGeometry = new THREE.SphereGeometry(stoneSize, 4, 4);
                const stoneMaterial = new THREE.MeshStandardMaterial({
                    color: Math.random() > 0.5 ? 0x999999 : 0x777777,
                    roughness: 0.9,
                    metalness: 0.1
                });
                
                const stone = new THREE.Mesh(stoneGeometry, stoneMaterial);
                stone.position.set(
                    Math.random() * 20 - 10,
                    stoneSize / 2,
                    Math.random() * 20 - 10
                );
                stone.castShadow = true;
                stone.receiveShadow = true;
                scene.add(stone);
            }
            
            // Add rangoli pattern - traditional Indian art form
            const rangoliGeometry = new THREE.CircleGeometry(2, 32);
            const rangoliMaterial = new THREE.MeshBasicMaterial({
                color: 0xff9933, // Saffron color for traditional Indian design
                transparent: true,
                opacity: 0.6
            });
            
            const rangoli = new THREE.Mesh(rangoliGeometry, rangoliMaterial);
            rangoli.rotation.x = -Math.PI / 2;
            rangoli.position.set(0, 0.01, 5);
            scene.add(rangoli);
            
            // Add clay lamps (diyas) - typical of 1950s Indian gatherings
            for (let i = 0; i < 12; i++) {
                const angle = i * Math.PI / 6;
                const radius = 2.2;
                
                const diyaGeometry = new THREE.ConeGeometry(0.1, 0.05, 16);
                const diyaMaterial = new THREE.MeshStandardMaterial({
                    color: 0xcd853f,
                    roughness: 0.8,
                    metalness: 0.1
                });
                
                const diya = new THREE.Mesh(diyaGeometry, diyaMaterial);
                diya.rotation.x = Math.PI / 2;
                diya.position.set(
                    Math.cos(angle) * radius,
                    0.025,
                    5 + Math.sin(angle) * radius
                );
                diya.castShadow = true;
                diya.receiveShadow = true;
                scene.add(diya);
                
                // Add flame
                const flameGeometry = new THREE.SphereGeometry(0.03, 8, 8);
                const flameMaterial = new THREE.MeshBasicMaterial({
                    color: 0xff9900,
                    emissive: 0xff6600,
                    emissiveIntensity: 0.5
                });
                
                const flame = new THREE.Mesh(flameGeometry, flameMaterial);
                flame.position.set(
                    Math.cos(angle) * radius,
                    0.07,
                    5 + Math.sin(angle) * radius
                );
                scene.add(flame);
                
                // Add small light
                const diyaLight = new THREE.PointLight(0xff9900, 0.3, 0.5);
                diyaLight.position.copy(flame.position);
                scene.add(diyaLight);
            }
            } catch (error) {
                console.error("Error creating ground:", error);
            }
        }
        
        function createStage() {
            console.log("Creating stage...");
            try {
                // Wooden platform
            const platformGeometry = new THREE.BoxGeometry(6, 0.6, 3);
            const woodTexture = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/wood/hardwood2_diffuse.jpg');
            const platformMaterial = new THREE.MeshStandardMaterial({
                map: woodTexture,
                roughness: 0.8,
                metalness: 0.1
            });
            
            const platform = new THREE.Mesh(platformGeometry, platformMaterial);
            platform.position.set(0, 0.3, 0);
            platform.receiveShadow = true;
            platform.castShadow = true;
            scene.add(platform);
            
            // Stage frame
            const frameGeometry = new THREE.BoxGeometry(0.2, 4, 0.2);
            const frameMaterial = new THREE.MeshStandardMaterial({
                map: woodTexture,
                roughness: 0.8,
                metalness: 0.1
            });
            
            // Create frame posts
            const post1 = new THREE.Mesh(frameGeometry, frameMaterial);
            post1.position.set(-2.9, 2.3, -1.4);
            post1.castShadow = true;
            scene.add(post1);
            
            const post2 = new THREE.Mesh(frameGeometry, frameMaterial);
            post2.position.set(2.9, 2.3, -1.4);
            post2.castShadow = true;
            scene.add(post2);
            
            const post3 = new THREE.Mesh(frameGeometry, frameMaterial);
            post3.position.set(-2.9, 2.3, 1.4);
            post3.castShadow = true;
            scene.add(post3);
            
            const post4 = new THREE.Mesh(frameGeometry, frameMaterial);
            post4.position.set(2.9, 2.3, 1.4);
            post4.castShadow = true;
            scene.add(post4);
            
            // Top frame
            const topFrameGeometry = new THREE.BoxGeometry(6, 0.2, 0.2);
            const topFrame1 = new THREE.Mesh(topFrameGeometry, frameMaterial);
            topFrame1.position.set(0, 4.3, -1.4);
            topFrame1.castShadow = true;
            scene.add(topFrame1);
            
            const topFrame2 = new THREE.Mesh(topFrameGeometry, frameMaterial);
            topFrame2.position.set(0, 4.3, 1.4);
            topFrame2.castShadow = true;
            scene.add(topFrame2);
            
            const sideFrameGeometry = new THREE.BoxGeometry(0.2, 0.2, 3);
            const sideFrame1 = new THREE.Mesh(sideFrameGeometry, frameMaterial);
            sideFrame1.position.set(-2.9, 4.3, 0);
            sideFrame1.castShadow = true;
            scene.add(sideFrame1);
            
            const sideFrame2 = new THREE.Mesh(sideFrameGeometry, frameMaterial);
            sideFrame2.position.set(2.9, 4.3, 0);
            sideFrame2.castShadow = true;
            scene.add(sideFrame2);
            
            // Backdrop with Indian mythological scene (Ramayana or Mahabharata common in 1950s puppet shows)
            const backdropGeometry = new THREE.PlaneGeometry(5.8, 3.8);
            const backdropTexture = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/terrain/grasslight-big.jpg');
            const backdropMaterial = new THREE.MeshStandardMaterial({
                map: backdropTexture,
                color: 0xffcc99, // Warm color typical for hand-painted backdrops of the era
                side: THREE.DoubleSide,
                roughness: 1.0
            });
            
            const backdrop = new THREE.Mesh(backdropGeometry, backdropMaterial);
            backdrop.position.set(0, 2.6, -1.3);
            scene.add(backdrop);
            
            // Red curtains
            const curtainGeometry = new THREE.PlaneGeometry(1.5, 3.8);
            const curtainTexture = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/terrain/grasslight-big.jpg');
            const curtainMaterial = new THREE.MeshStandardMaterial({
                map: curtainTexture,
                color: 0x8b0000,
                side: THREE.DoubleSide,
                roughness: 1.0
            });
            
            // Side curtains
            const leftCurtain = new THREE.Mesh(curtainGeometry, curtainMaterial);
            leftCurtain.position.set(-2.2, 2.6, -1.2);
            scene.add(leftCurtain);
            
            const rightCurtain = new THREE.Mesh(curtainGeometry, curtainMaterial);
            rightCurtain.position.set(2.2, 2.6, -1.2);
            scene.add(rightCurtain);
            
            // Center curtains (partially open)
            const centerCurtainLeftGeometry = new THREE.PlaneGeometry(1.5, 3.8);
            const centerCurtainLeft = new THREE.Mesh(centerCurtainLeftGeometry, curtainMaterial);
            centerCurtainLeft.position.set(-0.9, 2.6, -1.1);
            centerCurtainLeft.rotation.y = Math.PI / 12;
            scene.add(centerCurtainLeft);
            
            const centerCurtainRightGeometry = new THREE.PlaneGeometry(1.5, 3.8);
            const centerCurtainRight = new THREE.Mesh(centerCurtainRightGeometry, curtainMaterial);
            centerCurtainRight.position.set(0.9, 2.6, -1.1);
            centerCurtainRight.rotation.y = -Math.PI / 12;
            scene.add(centerCurtainRight);
            
            // Add traditional Kathputli puppets (typical of 1950s Indian puppet shows)
            addTraditionalPuppets();
            
            // Add puppet box
            const boxGeometry = new THREE.BoxGeometry(1, 0.8, 0.8);
            const boxMaterial = new THREE.MeshStandardMaterial({
                map: woodTexture,
                roughness: 0.8,
                metalness: 0.1
            });
            
            const puppetBox = new THREE.Mesh(boxGeometry, boxMaterial);
            puppetBox.position.set(-2, 0.7, -0.8);
            puppetBox.castShadow = true;
            puppetBox.receiveShadow = true;
            scene.add(puppetBox);
            
            // Add traditional drum - tabla (typical Indian percussion)
            const drumGeometry = new THREE.CylinderGeometry(0.25, 0.15, 0.4, 32);
            const drumMaterial = new THREE.MeshStandardMaterial({
                color: 0x8b4513,
                roughness: 0.8,
                metalness: 0.1
            });
            
            const drum = new THREE.Mesh(drumGeometry, drumMaterial);
            drum.position.set(2, 0.7, -0.5);
            drum.castShadow = true;
            drum.receiveShadow = true;
            scene.add(drum);
            
            // Add second tabla drum (they come in pairs)
            const drum2 = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.1, 0.35, 32),
                drumMaterial
            );
            drum2.position.set(2.4, 0.675, -0.5);
            drum2.castShadow = true;
            drum2.receiveShadow = true;
            scene.add(drum2);
            
            // Add drumheads
            const drumheadGeometry = new THREE.CircleGeometry(0.25, 32);
            const drumheadMaterial = new THREE.MeshStandardMaterial({
                color: 0xf5e8c0,
                roughness: 0.5,
                metalness: 0.1
            });
            
            const drumhead1 = new THREE.Mesh(drumheadGeometry, drumheadMaterial);
            drumhead1.position.set(2, 0.9, -0.5);
            drumhead1.rotation.x = -Math.PI / 2;
            scene.add(drumhead1);
            
            const drumhead2 = new THREE.Mesh(
                new THREE.CircleGeometry(0.2, 32),
                drumheadMaterial
            );
            drumhead2.position.set(2.4, 0.85, -0.5);
            drumhead2.rotation.x = -Math.PI / 2;
            scene.add(drumhead2);
            
            // Add simple oil lamp (common lighting in 1950s rural India)
            const lampGeometry = new THREE.CylinderGeometry(0.1, 0.15, 0.15, 16);
            const lampMaterial = new THREE.MeshStandardMaterial({
                color: 0x996633,
                roughness: 0.9,
                metalness: 0.2
            });
            
            const lamp = new THREE.Mesh(lampGeometry, lampMaterial);
            lamp.position.set(0, 4.1, -0.5);
            scene.add(lamp);
            
            // Add lamp flame
            const flameGeometry = new THREE.SphereGeometry(0.06, 8, 8);
            const flameMaterial = new THREE.MeshBasicMaterial({
                color: 0xffcc00,
                emissive: 0xff6600,
                emissiveIntensity: 0.7
            });
            
            const flame = new THREE.Mesh(flameGeometry, flameMaterial);
            flame.position.set(0, 4.2, -0.5);
            scene.add(flame);
            
            // Add lamp light
            const lampLight = new THREE.PointLight(0xff9900, 0.8, 10);
            lampLight.position.set(0, 4.1, -0.5);
            scene.add(lampLight);
            
            // Add rope for hanging lamp (typical of the era)
            const ropeGeometry = new THREE.CylinderGeometry(0.01, 0.01, 0.2, 8);
            const ropeMaterial = new THREE.MeshBasicMaterial({ color: 0x663300 });
            const rope = new THREE.Mesh(ropeGeometry, ropeMaterial);
            rope.position.set(0, 4.3, -0.5);
            scene.add(rope);
            } catch (error) {
                console.error("Error creating stage:", error);
            }
        }
        
        function addTraditionalPuppets() {
            // Add traditional Indian Kathputli puppets (popular in 1950s)
            // Main character puppet (like a king or hero)
            const puppetBodyGeometry = new THREE.CylinderGeometry(0.08, 0.15, 0.5, 8);
            const puppetBodyMaterial = new THREE.MeshStandardMaterial({
                color: 0xdd2222, // Red clothing common in traditional puppets
                roughness: 0.9,
                metalness: 0.1
            });
            
            // First puppet (hero/king character)
            const puppetBody1 = new THREE.Mesh(puppetBodyGeometry, puppetBodyMaterial);
            puppetBody1.position.set(-0.3, 3.0, -0.8);
            puppetBody1.castShadow = true;
            scene.add(puppetBody1);
            
            // Head
            const headGeometry = new THREE.SphereGeometry(0.12, 16, 16);
            const headMaterial = new THREE.MeshStandardMaterial({
                color: 0xeecaaa,
                roughness: 0.9,
                metalness: 0.1
            });
            
            const puppetHead1 = new THREE.Mesh(headGeometry, headMaterial);
            puppetHead1.position.set(-0.3, 3.35, -0.8);
            puppetHead1.castShadow = true;
            scene.add(puppetHead1);
            
            // Crown
            const crownGeometry = new THREE.ConeGeometry(0.1, 0.15, 5);
            const crownMaterial = new THREE.MeshStandardMaterial({
                color: 0xffcc00,
                roughness: 0.5,
                metalness: 0.5
            });
            
            const crown = new THREE.Mesh(crownGeometry, crownMaterial);
            crown.position.set(-0.3, 3.5, -0.8);
            crown.castShadow = true;
            scene.add(crown);
            
            // Arms
            const armGeometry = new THREE.BoxGeometry(0.4, 0.05, 0.05);
            const armMaterial = new THREE.MeshStandardMaterial({
                color: 0xdd2222,
                roughness: 0.9,
                metalness: 0.1
            });
            
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(-0.5, 3.1, -0.8);
            leftArm.rotation.z = Math.PI / 12;
            leftArm.castShadow = true;
            scene.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(-0.1, 3.1, -0.8);
            rightArm.rotation.z = -Math.PI / 12;
            rightArm.castShadow = true;
            scene.add(rightArm);
            
            // Strings (control rods for puppets)
            const stringGeometry = new THREE.CylinderGeometry(0.005, 0.005, 1.2, 3);
            const stringMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            
            const string1 = new THREE.Mesh(stringGeometry, stringMaterial);
            string1.position.set(-0.3, 4.0, -0.8);
            scene.add(string1);
            
            // Second puppet (female character)
            const puppetBodyMaterial2 = new THREE.MeshStandardMaterial({
                color: 0x2222dd, // Blue clothing
                roughness: 0.9,
                metalness: 0.1
            });
            
            const puppetBody2 = new THREE.Mesh(puppetBodyGeometry, puppetBodyMaterial2);
            puppetBody2.position.set(0.4, 3.0, -0.8);
            puppetBody2.castShadow = true;
            scene.add(puppetBody2);
            
            const puppetHead2 = new THREE.Mesh(headGeometry, headMaterial);
            puppetHead2.position.set(0.4, 3.35, -0.8);
            puppetHead2.castShadow = true;
            scene.add(puppetHead2);
            
            // Second puppet arms
            const leftArm2 = new THREE.Mesh(armGeometry, puppetBodyMaterial2);
            leftArm2.position.set(0.2, 3.1, -0.8);
            leftArm2.rotation.z = Math.PI / 12;
            leftArm2.castShadow = true;
            scene.add(leftArm2);
            
            const rightArm2 = new THREE.Mesh(armGeometry, puppetBodyMaterial2);
            rightArm2.position.set(0.6, 3.1, -0.8);
            rightArm2.rotation.z = -Math.PI / 12;
            rightArm2.castShadow = true;
            scene.add(rightArm2);
            
            // Strings for second puppet
            const string2 = new THREE.Mesh(stringGeometry, stringMaterial);
            string2.position.set(0.4, 4.0, -0.8);
            scene.add(string2);
        }
        
        function createAudience() {
            console.log("Creating audience...");
            try {
                // Create rows of chairs
            const chairGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            const chairLegGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.5, 8);
            const chairMaterial = new THREE.MeshStandardMaterial({
                color: 0x654321, // Darker wood for traditional seating
                roughness: 0.9,
                metalness: 0.1
            });
            
            // Create rows of simple seating mats (more authentic to 1950s rural Indian setting)
            for (let row = 0; row < 4; row++) {
                const z = 3 + row * 1.2;
                const numChairs = 7 - row;
                
                for (let i = 0; i < numChairs; i++) {
                    const x = (i - (numChairs - 1) / 2) * 0.8;
                    
                    // Simple mat/carpet for seating (common in 1950s Indian village gatherings)
                    const matGeometry = new THREE.BoxGeometry(0.6, 0.05, 0.6);
                    const matMaterial = new THREE.MeshStandardMaterial({
                        color: Math.random() > 0.5 ? 0xcc5500 : 0x996633, // Earthy tones for mats
                        roughness: 1.0,
                        metalness: 0.0
                    });
                    
                    const mat = new THREE.Mesh(matGeometry, matMaterial);
                    mat.position.set(x, 0.025, z);
                    mat.receiveShadow = true;
                    scene.add(mat);
                    
                    // Randomly add seated figures in traditional Indian clothing
                    if (Math.random() > 0.5) {
                        // Create figure (sitting cross-legged - typical in 1950s India)
                        const figureGeometry = new THREE.CylinderGeometry(0.15, 0.25, 0.3, 8);
                        
                        // Different clothing colors typical of 1950s rural India
                        const colors = [0xeecaaa, 0xe6e6fa, 0xffa07a, 0xffe4b5, 0xf5deb3];
                        const clothingColor = colors[Math.floor(Math.random() * colors.length)];
                        
                        const figureMaterial = new THREE.MeshStandardMaterial({
                            color: clothingColor,
                            roughness: 0.9,
                            metalness: 0.1
                        });
                        
                        const figure = new THREE.Mesh(figureGeometry, figureMaterial);
                        figure.position.set(x, 0.2, z);
                        figure.castShadow = true;
                        figure.receiveShadow = true;
                        scene.add(figure);
                        
                        // Add head
                        const headGeometry = new THREE.SphereGeometry(0.12, 12, 12);
                        const headMaterial = new THREE.MeshStandardMaterial({
                            color: 0x8d5524, // Typical skin tone
                            roughness: 0.9,
                            metalness: 0.1
                        });
                        
                        const head = new THREE.Mesh(headGeometry, headMaterial);
                        head.position.set(x, 0.45, z);
                        head.castShadow = true;
                        head.receiveShadow = true;
                        scene.add(head);
                        
                        // Add traditional headwear (turban or headscarf)
                        if (Math.random() > 0.5) {
                            // Turban
                            const turbanGeometry = new THREE.TorusGeometry(0.1, 0.05, 8, 12);
                            const turbanMaterial = new THREE.MeshStandardMaterial({
                                color: Math.random() > 0.5 ? 0xf5f5dc : 0xff6347,
                                roughness: 0.9,
                                metalness: 0.1
                            });
                            
                            const turban = new THREE.Mesh(turbanGeometry, turbanMaterial);
                            turban.position.set(x, 0.55, z);
                            turban.rotation.x = Math.PI / 2;
                            turban.castShadow = true;
                            scene.add(turban);
                        }
                    }
                }
            }
            } catch (error) {
                console.error("Error creating audience:", error);
            }
        }
        
        function createEnvironment() {
            console.log("Creating environment...");
            try {
                // Add traditional sound instrument - harmonium (popular in 1950s India)
                const harmoniumGeometry = new THREE.BoxGeometry(0.8, 0.3, 0.5);
                const harmoniumMaterial = new THREE.MeshStandardMaterial({
                    color: 0x8b4513,
                    roughness: 0.8,
                    metalness: 0.2
                });
                
                const harmonium = new THREE.Mesh(harmoniumGeometry, harmoniumMaterial);
                harmonium.position.set(-1.5, 0.7, -0.5);
                harmonium.castShadow = true;
                harmonium.receiveShadow = true;
                scene.add(harmonium);
                
                // Add keys to harmonium
                for (let i = 0; i < 7; i++) {
                    const keyGeometry = new THREE.BoxGeometry(0.08, 0.05, 0.25);
                    const keyMaterial = new THREE.MeshStandardMaterial({
                        color: 0xf5f5f5,
                        roughness: 0.5,
                        metalness: 0.1
                    });
                    
                    const key = new THREE.Mesh(keyGeometry, keyMaterial);
                    key.position.set(-1.7 + i * 0.11, 0.88, -0.5);
                    key.castShadow = true;
                    scene.add(key);
                }
                
                // Add simple megaphone made of metal (used in 1950s for announcements)
                const megaphoneGeometry = new THREE.ConeGeometry(0.25, 0.6, 16);
                const megaphoneMaterial = new THREE.MeshStandardMaterial({
                    color: 0xb87333, // Bronze color
                    roughness: 0.5,
                    metalness: 0.7
                });
                
                const megaphone = new THREE.Mesh(megaphoneGeometry, megaphoneMaterial);
                megaphone.position.set(5, 0.7, -3);
                megaphone.rotation.z = Math.PI / 2;
                megaphone.rotation.y = Math.PI / 4;
                megaphone.castShadow = true;
                scene.add(megaphone);
                
                // Add hand-crank for the megaphone
                const crankGeometry = new THREE.TorusGeometry(0.1, 0.02, 8, 16, Math.PI);
                const crankMaterial = new THREE.MeshStandardMaterial({
                    color: 0x606060,
                    roughness: 0.6,
                    metalness: 0.8
                });
                
                const crank = new THREE.Mesh(crankGeometry, crankMaterial);
                crank.position.set(5.3, 0.7, -3);
                crank.rotation.y = Math.PI / 4;
                crank.castShadow = true;
                scene.add(crank);
                
                // Add decorative elements typical of 1950s Indian festivals
                addTraditionalDecorations();
            } catch (error) {
                console.error("Error creating environment:", error);
            }
        }
        
        function addTraditionalDecorations() {
            // Add marigold flower garlands (common in Indian cultural events)
            const colors = [0xffa500, 0xff8c00, 0xffd700]; // Orange and yellow tones for marigolds
            
            // Create garlands around stage perimeter
            for (let i = 0; i < 12; i++) {
                const angle = i * Math.PI / 6;
                const radius = 3.5;
                
                const flowerGeometry = new THREE.SphereGeometry(0.12, 8, 8);
                const flowerMaterial = new THREE.MeshStandardMaterial({
                    color: colors[Math.floor(Math.random() * colors.length)],
                    roughness: 0.8,
                    metalness: 0.1
                });
                
                // Create cluster of flowers for each segment of garland
                for (let j = 0; j < 3; j++) {
                    const flower = new THREE.Mesh(flowerGeometry, flowerMaterial);
                    const offset = (j - 1) * 0.1;
                    
                    flower.position.set(
                        Math.cos(angle) * (radius + offset),
                        4.3 + Math.random() * 0.1,
                        Math.sin(angle) * (radius + offset)
                    );
                    
                    flower.scale.set(0.8 + Math.random() * 0.4, 0.8 + Math.random() * 0.4, 0.8 + Math.random() * 0.4);
                    flower.castShadow = true;
                    scene.add(flower);
                }
            }
            
            // Add colorful triangular flags (bunting) - common in 1950s Indian celebrations
            const flagColors = [0xff0000, 0xffff00, 0x00ff00, 0xff8c00, 0xff00ff];
            
            for (let i = 0; i < 10; i++) {
                const flagGeometry = new THREE.CylinderGeometry(0.01, 0.2, 0.3, 3);
                const flagMaterial = new THREE.MeshStandardMaterial({
                    color: flagColors[Math.floor(Math.random() * flagColors.length)],
                    roughness: 0.9,
                    metalness: 0.1,
                    side: THREE.DoubleSide
                });
                
                const flag = new THREE.Mesh(flagGeometry, flagMaterial);
                flag.position.set(-4 + i * 0.9, 5, -4);
                flag.rotation.x = Math.PI / 2;
                flag.castShadow = true;
                scene.add(flag);
                
                // Add connecting rope between flags
                if (i < 9) {
                    const ropeGeometry = new THREE.CylinderGeometry(0.01, 0.01, 0.9, 4);
                    const ropeMaterial = new THREE.MeshStandardMaterial({
                        color: 0x8b4513,
                        roughness: 1.0,
                        metalness: 0.0
                    });
                    
                    const rope = new THREE.Mesh(ropeGeometry, ropeMaterial);
                    rope.position.set(-3.55 + i * 0.9, 5, -4);
                    rope.rotation.z = Math.PI / 2;
                    rope.castShadow = true;
                    scene.add(rope);
                }
            }
            
            // Add incense/clay pots (common in 1950s Indian gatherings)
            for (let i = 0; i < 5; i++) {
                const potGeometry = new THREE.CylinderGeometry(0.08, 0.15, 0.2, 16);
                const potMaterial = new THREE.MeshStandardMaterial({
                    color: 0xa0522d,
                    roughness: 1.0,
                    metalness: 0.0
                });
                
                const pot = new THREE.Mesh(potGeometry, potMaterial);
                const angle = i * Math.PI / 2.5;
                const radius = 6;
                
                pot.position.set(
                    Math.cos(angle) * radius,
                    0.1,
                    Math.sin(angle) * radius
                );
                
                pot.castShadow = true;
                pot.receiveShadow = true;
                scene.add(pot);
                
                // Add incense smoke
                if (Math.random() > 0.5) {
                    const smokeGeometry = new THREE.ConeGeometry(0.03, 0.2, 8);
                    const smokeMaterial = new THREE.MeshBasicMaterial({
                        color: 0xdddddd,
                        transparent: true,
                        opacity: 0.6
                    });
                    
                    const smoke = new THREE.Mesh(smokeGeometry, smokeMaterial);
                    smoke.position.set(
                        pot.position.x,
                        pot.position.y + 0.2,
                        pot.position.z
                    );
                    scene.add(smoke);
                }
            }
        }
        
        function toggleView() {
            console.log("Toggling view to: " + (currentView === 'front' ? 'side' : currentView === 'side' ? 'above' : 'front'));
            try {
                if (currentView === 'front') {
                // Move to side view
                gsap.to(camera.position, {
                    x: 8,
                    y: 3,
                    z: 0,
                    duration: 1.5,
                    ease: 'power2.inOut',
                    onUpdate: function() {
                        camera.lookAt(0, 2, 0);
                    }
                });
                currentView = 'side';
            } else if (currentView === 'side') {
                // Move to above view
                gsap.to(camera.position, {
                    x: 0,
                    y: 8,
                    z: 2,
                    duration: 1.5,
                    ease: 'power2.inOut',
                    onUpdate: function() {
                        camera.lookAt(0, 1, 0);
                    }
                });
                currentView = 'above';
            } else {
                // Move back to front view
                gsap.to(camera.position, {
                    x: 0,
                    y: 2,
                    z: 10,
                    duration: 1.5,
                    ease: 'power2.inOut',
                    onUpdate: function() {
                        camera.lookAt(0, 2, 0);
                    }
                });
                currentView = 'front';
            }
            } catch (error) {
                console.error("Error toggling view:", error);
            }
        }
        
        function onWindowResize() {
            try {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            } catch (error) {
                console.error("Error resizing window:", error);
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            try {
                // Update controls
                controls.update();
                
                // Update any animations
                const delta = clock.getDelta();
                if (animationMixer) animationMixer.update(delta);
                
                // Make lanterns flicker slightly
                scene.children.forEach(child => {
                    // No need for flickering effects in bright afternoon light
                });
                
                renderer.render(scene, camera);
            } catch (error) {
                console.error("Error in animation loop:", error);
            }
        }
        
        // Start the scene when everything is loaded
        window.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded, initializing scene...");
            init();
        });
    </script>
</body>
</html>

